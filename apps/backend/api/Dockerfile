# This file is generated by Nx.
#
# Build the docker image with `npx nx container backend-api`.
# Tip: Modify "container" options in project.json to change docker build args.
#
# Run the container with `docker run -p 3000:3000 -t backend-api`.
FROM node:buster as builder
WORKDIR /app
COPY package.json .
RUN npm i
COPY . .
RUN npx prisma generate
RUN npx nx run backend-api:build:production


FROM node:alpine as runner

ENV HOST=0.0.0.0
ENV PORT=3000

WORKDIR /app
COPY --from=builder /app/dist/apps/backend/api /app

## You can remove this install step if you build with `--bundle` option.
## The bundled output will include external dependencies.
RUN npm i --ignore-scripts

RUN npx prisma generate --generator client

CMD [ "node", "." ]
