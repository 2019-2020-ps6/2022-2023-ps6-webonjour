# This file is generated by Nx.
#
# Build the docker image with `npx nx container util-scripts`.
# Tip: Modify "container" options in project.json to change docker build args.
#
# Run the container with `docker run -p 3000:3000 -t util-scripts`.
FROM node:20.3.0-alpine3.18 as builder
WORKDIR /app
COPY package.json .
RUN apk add --no-cache binutils-gold g++ gcc gnupg libgcc linux-headers make python3
RUN npm i
COPY . .
RUN npx prisma generate
RUN npx nx build util-scripts


FROM node:20.3.0-alpine3.18 as runner

WORKDIR /app
COPY --from=builder /app/dist/apps/util-scripts /app
COPY apps/util-scripts/entrypoint.sh /app

# You can remove this install step if you build with `--bundle` option.
# The bundled output will include external dependencies.
RUN npm i --ignore-scripts
RUN npx prisma generate --generator client
RUN chmod +x entrypoint.sh

ENTRYPOINT [ "./entrypoint.sh" ]
