# This file is generated by Nx.
#
# Build the docker image with `npx nx container util-scripts`.
# Tip: Modify "container" options in project.json to change docker build args.
#
# Run the container with `docker run -p 3000:3000 -t util-scripts`.
FROM node:alpine as builder
WORKDIR /app
COPY package.json .
RUN npm i
COPY . .
RUN npx prisma generate
RUN npx nx build util-scripts


FROM node:alpine as runner

WORKDIR /app
COPY --from=builder /app/dist/apps/util-scripts /app
COPY apps/util-scripts/entrypoint.sh /app

# You can remove this install step if you build with `--bundle` option.
# The bundled output will include external dependencies.
RUN npm i
RUN chmod +x entrypoint.sh

ENTRYPOINT [ "./entrypoint.sh" ]
